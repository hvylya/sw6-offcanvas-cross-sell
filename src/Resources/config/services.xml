<?xml version="1.0" encoding="UTF-8"?>
<container xmlns="http://symfony.com/schema/dic/services"
           xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
           xsi:schemaLocation="http://symfony.com/schema/dic/services
                               http://symfony.com/schema/dic/services/services-1.0.xsd">

    <services>
        <!-- sensible defaults -->
        <defaults autowire="true" autoconfigure="true" public="false"/>

        <!-- Cross-sell: providers     -->
        <service id="Hv\Offcanvas\CrossSell\Group\CrossSellGroupProvider">
            <argument key="$route"
                      type="service"
                      id="Shopware\Core\Content\Product\SalesChannel\CrossSelling\ProductCrossSellingRoute"/>
        </service>
        <service id="Hv\Offcanvas\CrossSell\Group\CrossSellGroupProviderInterface"
                 alias="Hv\Offcanvas\CrossSell\Group\CrossSellGroupProvider"/>

        <service id="Hv\Offcanvas\CrossSell\Product\ProductProvider">
            <argument type="service" id="product.repository"/>
        </service>
        <service id="Hv\Offcanvas\CrossSell\Product\ProductProviderInterface"
                 alias="Hv\Offcanvas\CrossSell\Product\ProductProvider"/>

        <!-- Cross-sell: selectors (tagged with priority) -->
        <service id="Hv\Offcanvas\CrossSell\Select\ProductCustomFieldPositionSelector">
            <tag name="hv.offcanvas.position_selector" priority="200"/>
        </service>

        <service id="Hv\Offcanvas\CrossSell\Select\GlobalConfigPositionSelector">
            <tag name="hv.offcanvas.position_selector" priority="100"/>
        </service>

        <!-- Selection (lazy) -->
        <service id="Hv\Offcanvas\CrossSell\Select\CrossSellSelectionService" lazy="true">
            <argument type="service" id="Hv\Offcanvas\CrossSell\Product\ProductProviderInterface"/>
            <argument type="service" id="Hv\Offcanvas\CrossSell\Group\CrossSellGroupProviderInterface"/>
            <argument type="tagged_iterator" tag="hv.offcanvas.position_selector"/>
        </service>

        <!-- Part 1: minimal offcanvas -->
        <service id="Hv\Offcanvas\Cart\AddToCartIntentExtractor"/>
        <service id="Hv\Offcanvas\Cart\LastAddedLineItemFinder"/>
        <service id="Hv\Offcanvas\Offcanvas\MinimalOffcanvasBuilder"/>

        <service id="Hv\Offcanvas\Cart\AddToCartIntentExtractorInterface"
                 alias="Hv\Offcanvas\Cart\AddToCartIntentExtractor"/>
        <service id="Hv\Offcanvas\Cart\LastAddedLineItemFinderInterface"
                 alias="Hv\Offcanvas\Cart\LastAddedLineItemFinder"/>
        <service id="Hv\Offcanvas\Offcanvas\MinimalOffcanvasBuilderInterface"
                 alias="Hv\Offcanvas\Offcanvas\MinimalOffcanvasBuilder"/>

        <!-- Decorator with default decoration-priority="0"
             order with other decorators is not guaranteed.
             Use -1024 to run last, +1024 to run first. -->
        <service id="Hv\Offcanvas\Storefront\Controller\AddToCartOffcanvasControllerDecorator"
                 decorates="Shopware\Storefront\Controller\CartLineItemController"
                 decoration-priority="-1024"
                 public="true">
            <argument key="$inner"
                      type="service"
                      id="Hv\Offcanvas\Storefront\Controller\AddToCartOffcanvasControllerDecorator.inner"/>
            <argument key="$productListRoute"
                      type="service"
                      id="Shopware\Core\Content\Product\SalesChannel\ProductListRoute"/>
        </service>
    </services>
</container>
